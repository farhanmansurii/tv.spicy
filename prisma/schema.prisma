// Prisma schema for SpicyTV
generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
}

model User {
	id            String    @id @default(cuid())
	email         String    @unique
	name          String?
	image         String?
	password      String?   // For credentials-based authentication
	emailVerified Boolean   @default(false)
	createdAt     DateTime  @default(now())
	updatedAt     DateTime  @updatedAt

	// Relations
	accounts      Account[]
	sessions      Session[]
	watchlist     Watchlist[]
	recentlyWatched RecentlyWatched[]
	favorites     Favorite[]
	recentSearches RecentSearch[]

	@@map("users")
}

model Account {
	id                    String    @id @default(cuid())
	accountId             String
	providerId            String
	userId                String
	accessToken           String?   @db.Text
	refreshToken          String?   @db.Text
	idToken               String?   @db.Text
	accessTokenExpiresAt  DateTime?
	refreshTokenExpiresAt DateTime?
	scope                 String?
	password              String?
	createdAt             DateTime  @default(now())
	updatedAt             DateTime  @updatedAt
	user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@unique([providerId, accountId])
	@@map("accounts")
}

model Session {
	id        String   @id @default(cuid())
	expiresAt DateTime
	token     String   @unique
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt
	ipAddress String?
	userAgent String?
	userId    String
	user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@map("sessions")
}

model Verification {
	id         String   @id @default(cuid())
	identifier String
	value      String
	expiresAt  DateTime
	createdAt  DateTime @default(now())
	updatedAt  DateTime @updatedAt

	@@map("verification")
}

model Watchlist {
	id          String   @id @default(cuid())
	userId      String
	mediaId     Int
	mediaType   MediaType
	posterPath  String?
	backdropPath String?
	title       String
	overview    String?  @db.Text
	addedAt     DateTime @default(now())

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@unique([userId, mediaId, mediaType])
	@@index([userId, mediaType])
	@@map("watchlist")
}

model RecentlyWatched {
	id            String    @id @default(cuid())
	userId        String
	mediaId       Int
	mediaType     MediaType
	seasonNumber  Int?
	episodeNumber Int?
	episodeId     Int?
	stillPath     String?
	episodeName   String?
	showName      String?
	progress      Int       @default(0) // Watch progress in seconds
	watchedAt     DateTime  @default(now())
	updatedAt     DateTime  @updatedAt

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@index([userId, mediaType])
	@@index([userId, mediaId, seasonNumber, episodeNumber])
	@@map("recently_watched")
}

model Favorite {
	id        String    @id @default(cuid())
	userId    String
	mediaId   Int
	mediaType MediaType
	addedAt   DateTime  @default(now())

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@unique([userId, mediaId, mediaType])
	@@index([userId, mediaType])
	@@map("favorites")
}

model RecentSearch {
	id        String   @id @default(cuid())
	userId    String
	query     String
	searchedAt DateTime @default(now())

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@index([userId, searchedAt])
	@@map("recent_searches")
}

enum MediaType {
	MOVIE
	TV
}
