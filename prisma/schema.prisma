// Prisma schema for SpicyTV
generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
}

model User {
	id        String   @id @default(cuid())
	email     String   @unique
	name      String?
	image     String?
	emailVerified DateTime?
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt

	// Relations
	accounts      Account[]
	sessions      Session[]
	watchlist     Watchlist[]
	recentlyWatched RecentlyWatched[]
	favorites     Favorite[]
	recentSearches RecentSearch[]

	@@map("users")
}

model Account {
	id                String  @id @default(cuid())
	userId            String
	type              String
	provider          String
	providerAccountId String
	refresh_token     String? @db.Text
	access_token      String? @db.Text
	expires_at        Int?
	token_type        String?
	scope             String?
	id_token          String? @db.Text
	session_state     String?

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@unique([provider, providerAccountId])
	@@map("accounts")
}

model Session {
	id           String   @id @default(cuid())
	sessionToken String   @unique
	userId       String
	expires      DateTime
	user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@map("sessions")
}

model VerificationToken {
	identifier String
	token      String   @unique
	expires    DateTime

	@@unique([identifier, token])
	@@map("verification_tokens")
}

model Watchlist {
	id          String   @id @default(cuid())
	userId      String
	mediaId     Int
	mediaType   MediaType
	posterPath  String?
	backdropPath String?
	title       String
	overview    String?  @db.Text
	addedAt     DateTime @default(now())

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@unique([userId, mediaId, mediaType])
	@@index([userId, mediaType])
	@@map("watchlist")
}

model RecentlyWatched {
	id            String    @id @default(cuid())
	userId        String
	mediaId       Int
	mediaType     MediaType
	seasonNumber  Int?
	episodeNumber Int?
	episodeId     Int?
	stillPath     String?
	episodeName   String?
	showName      String?
	progress      Int       @default(0) // Watch progress in seconds
	watchedAt     DateTime  @default(now())
	updatedAt     DateTime  @updatedAt

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@index([userId, mediaType])
	@@index([userId, mediaId, seasonNumber, episodeNumber])
	@@map("recently_watched")
}

model Favorite {
	id        String    @id @default(cuid())
	userId    String
	mediaId   Int
	mediaType MediaType
	addedAt   DateTime  @default(now())

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@unique([userId, mediaId, mediaType])
	@@index([userId, mediaType])
	@@map("favorites")
}

model RecentSearch {
	id        String   @id @default(cuid())
	userId    String
	query     String
	searchedAt DateTime @default(now())

	user User @relation(fields: [userId], references: [id], onDelete: Cascade)

	@@index([userId, searchedAt])
	@@map("recent_searches")
}

enum MediaType {
	MOVIE
	TV
}
